# Shell编程

在Linux的世界里，没有什么是不可控的。如果想成为高级Linux高手，那么Shell编程是必须的。

## 正则表达式

正则表达式：一组对正在查找的文本的描述。

有两套可以用于正则表达式编程：POSIX库和PCRE库。

>egrep "^a.\*t$" /share/ditc/words | wc -w

### 字符集和单词

句点 . 可以用于匹配除换行符之外的任意一个字符

方括号[]用于指定一个字符集，匹配其中的一个字符
>[abc] 匹配a/b/c中一个

连字符- 描述一个范围，下面的表达式匹配所有英文字母
>[a-zA-Z]\*

数字也可以指定范围
>[0-9]

为了严格匹配，可以加上一对分隔符"\<"和"\>"
> \<[a-z]at\>

单词的定义：两侧由费单词字符分割的字符串。非单词：字母/数字/下划线以外的任何字符。

### 字符类

除了字符集，还提供了字符类。
> egrep "^[[:upper:]]t$" words

字符类有以下：
- [[:alnum:]] 文字/数字字符
- [[:alpha:]] 字母字符
- [[:lower:]] 字母字符
- [[:upper:]] 大写字母
- [[:digit:]] 小数
- [[:punct:]] 标点符号
- [[:blank:]] 制表符和空格
- [[:space:]] 空格
- [[:cntrl:]] 所有控制符
- [[:print:]] 所有可打印的字符
- [[:graph:]] 除空格外所有可打印的字符

### 位置匹配
- ^ 用于匹配行首
- $ 用于匹配行尾

### 字符转义
转义字符\

### 重复
- \* 表示应该重复0次或多次
- \+ 表示重复1次或者多次
- ? 表示重复0次或者1次
- {}可以明确指定重复次数
{3}表示重复3次

{3,}表示重复3次或更多

在{5,12}表示重复不少于5次，不多于12次

### 子表达式
>grep "(or){2,}" /sur/share/dict/words

>sororities                                                  
>sorority                                                   

>sorority's

### 反义
下面的表达式匹配除了字母y的任何字符
>[^y]

下面的表达式匹配除了字母aeiou的所有字符
>[^aeiou]

注意^表示行首和反义时的位置区别

下面的表达式匹配所有不以y开头的行
>^[^y]

### 分支
正则表达式默认执行“与”的组合

分支（竖线|）完成“或”的组合

下面的表达式匹配以字母h开头，或以字母t结尾的行
>^h|t$

### 逆向引用
用户可以使用反斜杠\加上子表达式的编号来只带该分组匹配到的内容。

## Shell脚本编程
严格的说是BASH编程。包含了很多内容。

写Shell脚本不需要编译器，直接在Vim里写即可。

### 写一个hello world
````
#! /bin/bash
#Display a line

echo "Hello World!"
````
要执行这个Shell脚本，首先为它加上可执行权限。
> chmod +x hello

> ./hello

第一行告诉Shell，这个脚本运行时应该是用哪个Shell程序，本例中使用的是BASH。一般来说，Shell程序的第一行总是以这个开头，指定脚本的运行环境。

以#开头的是注释，会直接忽略。保持写注释的习惯是很好的习惯。

Shell脚本会忽略空行。所以用空行分割程序的不同部分是很好的习惯。

echo命令把其参数传递给标准输出。当是字符串时需要用""括起来。

### 变量和运算符
````
#! /bin/bash

#将一个字符串赋给变量output
log="monday"

echo "The value of logfile is:"

#美元符号$用于变量替换
echo $log
````
在Shell中使用变量，不需要提前声明，直接使用变量名就可以了。

美元符号用于对变量的解析。

变量只在其所在的脚本内有效，脚本退出后，变量失效。

使用source命令可以强行让一个脚本影响其父shell环境。
> $ source varible

export命令可以让脚本影响子shell环境

使用unset命令手动注销一个变量

Shell 使用花括号来限定一个变量的开始和结束。当紧跟变量输出字母后缀时，需要使用这个功能。

位置变量

Shell 脚本用位置变量保存参数。传递给脚本文件的参数分别存放在$ 符号带有数字的变量中。第一个参数存放在$1中。

一个比较特殊为止变量是$0,这个变量用于存放脚本自己的名字。有些时候，如创建这个文件时非常有用。
````
#！ /bin/bash

echo "\$0=*$0*"
echo "\$1=*$1*"
echo "\$2=*$2*"
echo "\$3=*$3*"
````

除了以数字命名的位置变量，Shell还提供了另外3个位置变量。
- $* 包含参数列表
- $@ 同上
- $# 包含参数个数

````
#! /bin/bash

echo "$# file(s) to list"

for file in $@
do 
	ls -l $file
done
````

### BASH引号规则
- 双引号 阻止Shell对大多数特殊字符进行将解释。
- 单引号 阻止Shell对所有字符进行解释
- 倒引号 会执行命令，将执行后的输出结果作为这个表达式的值
````
#! /bain/bash
log = Saturday

#双引号会对其中的$字符进行解释
echo "Today is $log"

#单引号不会对其中的$字符进行解释
echo 'Today is $log'

#倒引号会运行其中的命令，并把命令输出作为最终结果
echo "Today is 'date'"

````

### 表达式求值
Shell脚本是一种弱类型语言。

$[]告诉表达式要求值。

expr命令也可以对表达式执行求值。

### 脚本执行命令和控制语句
````
if test-commands
then
	commands
fi
````



