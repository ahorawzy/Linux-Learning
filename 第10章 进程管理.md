# 进程管理
## 什么是进程
正在运行的程序。Linux是多用户/多进程的操作系统。在Linux内核中维护着一张表，记录了当前系统中运行的所有进程的各种信息。Linux内核自动完成对进程的控制和调度。其中的信息包括：
- 进程的内存地址
- 进程当前状态
- 进程正在使用的资源
- 进程的优先级
- 进程的属主
Linux提供了让用户可以对进程进行监视和控制的工具。

## 进程的属性

### PID号
Linux用PID确定进程，要求用户管理进程时也提供PID号。

### PPID：父进程的PID
在Liunx中，所有的进程都必须由另一个进程创建——除了系统引导时，由内核自主创建并安装的几个进程。子进程使用PPID指出谁是其父进程。但事实上没有“创建”，而是子进程是父进程的克隆体。

### UID和EUID：真实和有效的用户ID
只有进程的创建者和root用户才有权利对该进程操作。记录一个进程的创建者（属主）非常必要。进程的UID号就是其创建者用户的ID号，用于标识进程的属主。

EUID是“有效用户ID号”。大部分情况下，UID和EUID是一样的。除了setuid程序。

### GID和EGID：真实和有效的组ID

### 谦让度和优先级
Linux内核会综合考虑一个进程的各种因素来确定其优先级。决定进程何时被处理是内核的事情，不需要用户插手。

用户可以通过设置进程的“谦让度”来影响内核的想法。“谦让度”和“优先级”的概念相反。

## 监视进程：ps命令
ps 是最常用的监视进程命令。
>ps aux

用于显示系统上运行的所有进程的信息。

字段含义如下：
- USER 进程创建者的用户名
- PID 进程的ID号
- %CPU 进程占用的CPU百分比
- %MEM 进程占用的内存百分比
- VSZ 进程占用的虚拟内存大小
- RSS 内存中页的数量（页是管理内存的单位）
- TTY 进程所在终端的ID号
- STAT 进程状态

	字母含义如下：
	- R 正在运行/可运行
	- D 睡眠中（不可唤醒，通常在等待I/O设备）
	- S 睡眠中（可唤醒）
	- T 停止（由于收到信号或被跟踪）
	- Z 僵进程（已经结束而没有被释放系统资源的进程）

	附加标识有：
	- < 进程有比普通优先级高的优先级
	- N 进程有比普通优先级低的优先级
	- L 有些页面被所在内存中
	- s 回会话的先导进程
- START 进程启动的时间
- Time 进程已经占用的CPU时间
- COMMAND 命令和参数

## 即时跟踪进程信息：top命令
ps可以一次性给出当前系统中进程信息的快照，但往往缺乏时效性。当管理员需要实时监视进程运行情况时，就需要不停地执行ps。

Linux提供top命令即时跟踪当前系统中进程的情况。

top会占满一页，10s更新一次。使用CPU最多的排在前面。使用q退出这个监视程序。

## 查看占用文件的进程：lsof
lsof能够列出当前系统中所有打开文件的进程信息，需要提供魏建明作为参数。

## 向进程发送信号：kill
kill [-signal] pid

kill -l 显示所有信号及其编号

常用信号：
- 0 EXIT 程序退出时收到该信号
- 1 HUP 挂起
- 2 INT 中断
- 3 QUIT 退出
- 9 KILL 杀死
- 11 SEGV 段错误
- 15 TERM 软件终止

默认情况下，kill命令发送TERM信号，请求终止某项操作。

但kill命令不是一定可以终止一个进程。程序可以“封锁”或者“忽略”捕捉到的信号。

Linux中 C-c 对应于信号INT。bc捕捉并忽略了该信号，告诉用户应该使用quit命令退出程序。

如果程序badpro能够忽略TERM信号，那么kill-TERM命令将对它不起作用。
>\#! /bin/bash

>trap "" TERM

>while echo "I'm making files!!"

>do

>	mkdir adir

>	cd adir

>	touch afile
>

>	sleep 5s

>done

其中trap " " TERM用于忽略TERM信号。

但有一个信号永远不能被程序捕捉，就是Kill信号。可以在内核级别杀死一个进程
>sudo kill -9 pid

但仍有一些进程不能被kill杀死，此时重启是唯一的方法。

## 调整进程的谦让度
nice命令可以在启动程序时调整其谦让度。高谦让度意味着低优先级，低谦让度（特别是为负的）拥有更高优先级。【-20,19】

nice命令通过接受一个-n参数增加程序的谦让度值。

renice可以在进程运行时调整其谦让度。

如今的CPU已经足够强大，能够合理地对进程进行调度。CPU总是等待哪些缓慢的I/O设备完成数据的读写和传输任务。

## /PROC文件系统
这是一个特殊的文件系统。底下存放这内核有关状态的各种有意义的信息。系统运行中，内核随时向这个目录写入数据。这是操作系统向用户提供的一条通往内核的通道。
